---
title: 深浅拷贝(复制)

categories:
  - web

tags:
  - js
---

拷贝，copy，复制，抄本、副本、别本。

拷贝就是拷贝指向对象的指针，意思就是说，拷贝出来的目标对象的指针和源对象的指针指向的内存空间是同一块空间！

拷贝分浅拷贝和深拷贝。

<!-- more -->

# JavaScript 数据类型

要了解深浅拷贝，先回顾 JavaScript 数据类型。

- JavaScript 数据类型
  - 原始类型(primitive type)，基本类型
    - Undefined
    - Boolean
    - Number
    - String
    - Null
  - 引用类型，类(class)，对象
    - Object 对象
    - Array 对象
    - Boolean 对象
    - Number 对象
    - String 对象
    - Function 对象(类)
    - arguments 对象
    - Math 对象
    - Date 对象
    - RegExp 对象
    - Error 对象
    - 其他全局对象

变量可以存在两种类型的值，即原始值和引用值。

原始类型或基本类型的值，就是原始值。

引用类型的值，就是引用值。

原始值，存储在栈(stack)中的简单数据段，也就是说，它们的值直接存储在变量访问的位置。

引用值，存储在堆(heap)中的对象，也就是说，存储在变量处的值是一个指针(point)，指向存储对象的内存处。

## 原始类型或基本类型

原始值，存储在栈(stack)中的简单数据段，也就是说，它们的值直接存储在变量访问的位置。栈区包括了变量的标识符和变量的值。

### 按值传递(call by value)

``` js
var a, b // undefined, undefined

a = 0 // 0

b = a // 0

a = '1' // '1'

console.log(a, b, typeof a, typeof b) // '1' 0 string number
```

上面 a 的改变没有改变 b，说明原始类型是按值传递的。赋值时创建了一块新的内存空间。

按值传递是最常用的求值策略，传递的是值的拷贝，也就是说传递后就互不相关了。

``` js
var num = 0

function foo (param) {
  // b 是形参
  param += 1

  console.log(num, param) // 0, 1
}

foo(num) // a 是实参
```

函数的形参是被调用时所传实参的副本。修改形参的值并不会影响实参。

### 不可变(immutable)性质

基本类型，其值是不可修改的，也不能为其添加属性和方法。

``` js
var str = 'abc'
str[0] // 'a'
str[0] = 'd'

console.log(str[0], str) // 'a', 'abc'

str.age = 24

console.log(str.age, str) // undefined, 'abc

str.method = function () {}

console.log(str.method, str) // undefined, 'abc
```

## 引用类型

引用值，存储在堆(heap)中的对象，也就是说，存储在变量处的值是一个指针(point)，指向存储对象的内存处。

引用类型的存储空间将从堆(heap)中分配。由于引用值的大小会改变，所以不能把它放在栈(stack)中，否则会降低变量查寻的速度。

相反，放在变量的栈(stack)空间中的值是该对象存储在堆(heap)中的地址。

地址的大小是固定的，所以把它存储在栈(stack)中对变量性能无任何负面影响。

# 深浅拷贝

深浅拷贝是针对对象而言的。

# 浅拷贝

shallow copy

按位拷贝对象，它会创建一个新对象，这个对象有着源对象属性值的一份精确拷贝。

如果属性是基本类型，拷贝的就是基本类型的值；如果属性是内存地址(引用类型)，拷贝的就是内存地址。

因此如果其中一个对象改变了这个地址，就会影响到另一个对象。即默认拷贝构造函数只是对对象进行浅拷贝复制(逐个成员依次拷贝)，即只复制对象空间而不复制资源，只复制引用而不复制真正的值。

待补充。

# 深拷贝

待补充。
